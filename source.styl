main-bg = #333
sec-bg = #444
third-bg = #555

code-bg = #2b2b2b

main-font-color = #bbb

heading = #b9c5cf

link-default = #93b2d0
link-hover = #738290

dark-green = #294436
dark-blue = #385570
dark-grey = #484a4a

hljs-default = #a9b7c6
hljs-comment = gray
hljs-string  = #390
hljs-keyword = #cc7833
hljs-literal = #9876aa
hljs-tag   = #63a35c
hljs-name  = #d0d0ff
hljs-title = #ffc66d
hljs-reserved = #1d3e81

font-blue  = #49f
font-red   = #f66
font-green = #0d0

comment-new = #445
comment-ts = #454
comment-author = #554

epic_fail =  #785555
fail =       #827454
normal =     #657380
successful = #707855

negative = #a44
positive = #4a4

code-font = Consolas, Menlo, Monaco, 'Courier New', monospace

filter(value)
    -webkit-filter: value
    filter: value

img_grayscale(hover = true)
    opacity: 0.5
    transition: all .3s
    filter(grayscale(.8))

    &.image-inverted
        filter(grayscale(.8) invert(1))

    if hover
        &:hover
            opacity: 1
            filter(grayscale(0))

        &.image-inverted:hover
            filter(grayscale(0) invert(1))

button-hover(color = sec-bg)
    background-color: color

    &:hover
        background-color: lighten(color, 14)

link(color = link-default)
    color: color

    &:visited:not(.button)
        color: link-hover


// Common Styles
#TMpanel
    z-index: 2
    background: #111
    border: none
    position: relative

    .container
        .bmenu
            a
                color: link-default

                &.current
                    color: link-hover

            &_inner a[href^="http://bit.ly"]
                color: darken(link-default, 30) !important

body
    background-color: main-bg
    color: main-font-color

    &.nl .layout
        background-color: main-bg

#layout, #xpanel, .to_top
    z-index: 1

#edit_tags_form
    background: transparent

.company_header, .user_header, .content_left, .sidebar_right, .rotated_posts, #footer
    z-index: 0
    position: relative

h1, h2, h3, h4, h5, h6
    color: heading

a
    link()

.top_banner img, .announce img, .author-info__image-pic, .html_banner
    img_grayscale()

.html_banner
    background: none
    border: 1px solid #838383

.icon_briefcase2, .post .hubs
    &::before
        img_grayscale(false)

.checkbox, .radio
    &__label
        color: main-font-color

.checkbox__label::before
    background-color: third-bg

.grey a, a.grey
    color: link-hover

input[type=text], .hubs_list .hubs_suggest input, .companies_list .companies_suggest input
    background: sec-bg
    color: white
    border-color: third-bg

form .item, form .digest, .inner_search_form
    label, span
        color: #838383

    input
        &[type=text], &[type=email], &[type=password]
            @extends input[type=text]

.notes table tr td
    border-bottom-color: third-bg

#people-tags li a, .habr-badge
    color: white

.columns-group__column + .columns-group__column
    border-color: transparent

.layout__row_footer
    background: third-bg

    &-links
        background: sec-bg

// Access denied page TODO
#logo, #reg-wrapper
    z-index: 1
    position: relative

#reg-wrapper
    border-color: transparent

.main
    h1, h2, h3, h4, h5, h6
        color: heading
// end

.rotated_posts
    border: none

.page_head
    z-index: 200

.page-nav
    a, a:visited:not(.button)
        color: link-default
    #nav-pages li em
        background: #6da3bd
        color: #333

.page_head h2.title
    color: heading

.user_header h2.username a,
.page_head h2.title
    color: link-default

.hubs_list ul li.hidden
    display: none

    &[style="display: list-item;"]
        display: inline-block !important

.social_accounts a
    opacity: .5
    transition: opacity .3s

    &:hover
        opacity: 1

.author-info
    background: transparent

    &__name, &__nickname
        color: #6a6a6a

.author-panel
    border:none

.btn_navbar_user-dropdown>img
    img_grayscale()

.user_profile .summary img
    img_grayscale()

.profile-section__about-text
    color: main-font-color

.info_page
    h1, h2, h3, h4, h5, h6
        color: darken(#ff6000, 10)

#yandex_ad, #yandex_ad_bottom
    background: main-bg !important

    .yap-yandex_ad-posterVertical .yap-logo-block__text
        color: link-default !important

    .yap-yandex_ad-posterVertical .yap-layout_block_poster .yap-layout__title,
    .yap-yandex_ad-posterVertical .yap-layout_block_poster .yap-layout__slider,
    .yap-yandex_ad-posterVertical .yap-layout_block_poster .yap-layout__warning
        background: rgba(255, 255, 255, .5) !important

    .yap-yandex_ad-posterVertical .yap-layout_block_poster .yap-layout__item_picture_false
        background: transparent !important

    .yap-yandex_ad-posterVertical .yap-layout__item
        border-color: inherit !important

    .yap-yandex_ad-posterVertical .yap-layout__item_abused,
    .yap-yandex_ad-posterVertical .yap-layout_block_poster .yap-layout__item_abused
        background: transparent !important


.search-field__input[type=text]
    @extends input[type=text]


.post-type-selector
    background-color: sec-bg

#global_notify, .global_notify
    .inner_notice
        background: #454
        color: inherit

// Navbar
body.nl .layout__row_navbar
    background-color: #2e2e2e
    border-color: #222

    .main-navbar
        background-color: inherit

    .badge:not(:empty)
        background: #79b
        box-sizing: content-box
        color: black
        text-shadow: none

body.nl .layout__elevator
    &:hover
        background: third-bg

    &:active
        background: sec-bg


// Comments list
.comments
    &-placeholder__text
        color: inherit

    &-form__placeholder
        background: transparent
        border-color: gray

.form-placeholder
    &__title
        color: heading

    &__text
        color: inherit

.comment__message, .comment-form__preview
    color: main-font-color

.comments_list

    .comment_item_plain .post_info .count
        color: negative

    .comment_item
        .comment_body.is_selected

            &::after
                content: "˃"
                font-family: code-font
                background: none
                font-weight: 600
                font-size: 1.2em
                line-height: 1.7em
                text-align: center
                color: lighten(comment-new, 30)

            .info .folding-dot
                right: 21px

        .message[class*=bad]
            background: transparent

        .info
            &.is_new
                background: comment-new

            &.is_topic_starter
                background: comment-ts

            &.is_author
                background: comment-author

            .folding-dot
                background-image: none
                &::before
                    content: '・・・・・・・・・・・・・・・・';
                    display: block;
                    position: absolute;
                    top: -9px;
                    right: -2.5px;
                    font-size: 1.2em;
                    color: lightgray;
                    letter-spacing: 6.8px;

            .voting .mark
                .negative span
                    color: negative

                .positive span
                    color: positive

        time
            color: #aaa

            &:hover
                color: #aaa

        a.avatar img, .comment-item__avatar
            img_grayscale()

        .comment-item__avatar-img_default::before
            background-color: transparent

.comment__head_topic-author
    background-color: dark-green
.comment__date-time
    color: main-font-color
.user-info__nickname_comment
    color: link-default
.user-info__nickname:hover, .user-info__nickname:active
    color: link-hover

// Content
.content_left
    .submenu, table.menu tr td a
        background: third-bg
        border: 0
        color: white

    .submenu .item.active, table.menu tr td.active a
        background: sec-bg
        border: 0
        color: #d3e2f0

    .submenu .item
        a
            color: link-default

        &.active a
            color: link-hover

    table.menu tr td
        &, &.active
            border-color: transparent

        span.count_new
            color: positive

    .tabs
        .tabs-menu, .menu_sub
            background: rgba(0, 0, 0, .1)
        .tabs-menu .tab-item
            border-right-color: rgba(0, 0, 0, .3)

            span
                color: main-font-color

            &:hover
                background: rgba(255, 255, 255 .1)

            &_current
                background: rgba(0, 0, 0, .2)

// Wtrfall
.wtf_bc
    &--skin
        &--bg-primary&--bg-primary
            background: inherit !important

        &--sec-text&--sec-text
            color: rgba(255, 255, 255, .3) !important

        &--main-text&--main-text
            color: inherit !important

        &--bg-gray&--bg-gray
            background: sec-bg !important
            border: 0 !important

    .wtf_broadcast &-feed &--feed-item&--hot &--feed-item--bg&--feed-item--bg
        background: inherit !important

    .wtf_broadcast &--header&--header--updates&--header&--header--updates
        background: darken(#25A971, 10)

        &:hover
            background: darken(#28B579, 9)


    .wtf_broadcast &--need-more-items &--need-more-items--button&--need-more-items--button
        background: darken(#407BDC, 10)

        &:hover
            background: darken(#3C72CC, 9)

    &--skin--link&--skin--link
        color: link-default !important

        &:hover
            color: link-hover !important

    &--userpic, &--og--pic
        img_grayscale()



.default-block
    background: #222
    opacity: .5 !important
    transition: all .3s

    &:hover
        opacity: 1 !important

    &__header
        border-bottom: 1px solid dark-grey

        &-title
            color:  link-default !important
            &:hover
                color: link-hover !important

    &__polling-title
        color: main-font-color

    .checkbox__label_poll,
    .radio__label_poll
        color: main-font-color

.stacked-menu
    &__item-text
        color: link-default

.toggle-menu
    border: none
    background: sec-bg

.toggle-menu__most-read,
.toggle-menu_most-comments
    background-color: transparent

.toggle-menu__item-link
    color: main-font-color
    border: none

.toggle-menu__item-link_active
    color: heading
    background: third-bg

// Sidebar
.sidebar_right // TODO merge with bottom promo?
    img, iframe, embed
        img_grayscale()

    .block, .sidebar-block
        background: #222
        opacity: .5 !important
        transition: all .3s

        &.best_company .company_info p a,
        &.new_vacancies .vacanies .job_item a,
        &.freelansim .tasks .task a
            link()

        &:hover
            opacity: 1 !important

        .for_authors_help
            .row .text
                color: #858585

            .line
                background: third-bg !important
                border-top: 1px solid main-bg

        .about_exchange, .for_authors_help
            .row .g-icon
                color: rgba(255, 255, 255, .2)

        > .show_more
            background: #383838

        > .line-r
            background: #504E4E

            &::after
                border-color: #646464

        &.twitter_stream .tweets .tweet .text
            color: #aaa

        a
            color: #8392a0 // TODO

        &.mobile_applications
            .app_widget
                .app_title
                    color: #5f5f5f

                .description
                    color: #6c6362

        .posts_list .post_item
            a.post_name
                color: #b5b5b5

                &:visited
                    color: #666

            .count
                color: negative

    .xyz_wrapper
        img_grayscale()

        &_inner
            background: none
            border: 1px solid #838383

.post__type-label
    background-color: third-bg
    border: none

.post-info__title
    color: heading

// Conversation page
.page__body_conversation
    .content-list__item
        &_bordered
            border-color: third-bg

        &_conversation:hover
            background-color: third-bg


    .user-message
        &__username
            color: #aaa

        &__body
            color: #ccc

            img
                img_grayscale()

        &_my .user-message__body
            color: #bc8

        .media-obj__image
            img_grayscale()

    .messages .message
        border-top: 1px solid third-bg

        .info
            .time
                color: white

            .media-obj__image
                img_grayscale()

            .login a
                color: #ddd

                &:hover
                    color: #aaa

        &.new .info
            background: comment-new

        &.my .info
            background: comment-author


.conversations .conversation
    &.new, &:hover
        background: sec-bg
        border-color: sec-bg
        border-bottom-color: third-bg

    a.conversation_link
        link()

    a.delete
        filter(invert(1))

.post-stats
    border: none

// Post
.post
    .post__title
        &, a.post_title, a.post__title_link, .post__title-text
            link(heading)

        .flag
            cursor: default
            img_grayscale()

    .hubs a.subscribed
        color: positive

    .poll
        .poll_title
            color: #999

        table.result tr td strong
            color: #999

    ul.tags li a
        link()

    div.tags
        color: gray

    .fb_iframe_widget
        background: #bbb

    twitterwidget::shadow
        .SandboxRoot
            color: inherit

        .EmbeddedTweet
            background: none

        .FollowButton
            opacity: .5

        .TweetAuthor-avatar
            img_grayscale()

        .MediaCard-media
            img_grayscale()

    .content a:not(.habracut)
        link()

    &__tags
        color: inherit

.post__text-html
    color: main-font-color
    blockquote
        background-color: rgba(67, 67, 67, .6);

.article
    .megapost-cover__img
        img_grayscale()



    &__body
        border-color: transparent

        &-text, .t-text
            color: inherit

        .t-heading, .t-title
            color: heading

        iframe, object, img
            img_grayscale()

        [class^=t-container_]
            background-color: rgba(0, 0, 0, .6);
            transition: all .3s

            &:hover
                background-color: transparent

    .postinfo-panel
        background-color: transparent

    &__button-more_habr
        color: dark-blue
        border-color: dark-blue

        &:hover
            background-color: dark-blue

    .clear
        clear: both

    span.g-icon.g-icon-twitter::before
        content: ''

    .t-carousel
        &__item__img
            img_grayscale()

        &__indicator
            background-color: #ddd !important

        &__arrow
            border-color: #ddd !important


// Infopanel
.postinfo-panel
    background-color: transparent
    border-color: sec-bg

    .postinfo-panel__item
        .post-author__pic, .post-author__pic_default
            img_grayscale(false)

            &::before
                background-color: transparent

        &:hover
            .post-author__pic, .post-author__pic_default
                opacity: 1
                filter(grayscale(0))

        .post-author__name
            color: main-font-color

    .voting-wjt, .post-comments
        border-color: sec-bg

    .post-share a
        opacity: .5
        transition: opacity .3s

        &:hover
            opacity: 1

.post-type
    background-color: transparent
    border-color: sec-bg

// HTML form (post, comment, pm)
.post__text-html, .comment__message
    h1, h2, h3, h4, h5, h6
        color: heading

    a
        link()

    .spoiler .spoiler_text
        background: sec-bg
        border: 0

    .MJXc-display
        overflow-y: hidden
        overflow-x: auto

    .mjx-math
        color: hljs-default
        padding: .2em
        margin: -.2em 0

    font
        &[color="#0000FF"], &[color="blue"]
            color: font-blue

        &[color="#FF0000"], &[color="red"]
            color: font-red

        &[color="#00FF00"], &[color="green"]
            color: font-green

        &[color="#000000"], &[color="black"]
            color: main-font-color

    iframe, object, img
        img_grayscale()

    img
        filter(invert(0))
        &.image-inverted
            filter(invert(1))

    &.message a.unchecked_link
        &, &:visited
            color: #b17474 !important

.post__text-html img
  img_grayscale()

// Code highlight
.html_format, .madskillz_page, .help_holder
    code
        border: 0
        display: inline-block
        padding: .2em
        margin: -.2em 0

    pre code
        background: code-bg
        border: 0
        display: block

        &, &.nohighlight
            color: hljs-default

    code, pre code.hljs
        color: hljs-default
        background: code-bg
        font-family: code-font
        font-size: 13px

code.hljs
    .hljs
        &-comment, &-javadoc, &-shebang, &-quote
            color: hljs-comment

        &-string, &-doctag, &-sqbracket, &-regexp, &-attribute, &-emphasis, &-blockquote,
        &-link_label, &-strong &-preprocessor, &-preprocessor &-title
            color: hljs-string

        &-keyword, &-javadoctag, &-at_rule, &-type, &-typename, &-important,
        &-subst, &-selector-tag, &-phpdoc, &-setting, &-request
            color: hljs-keyword

        &-literal, &-number, &-variable, &-hexcolor, &-built_in, &-function,
        &-attribute, &-tag &-attr, &-template-variable, &-common, &-cbracket,
        &-link_reference, &-prompt, &-symbol, &-params, &-bullet, &-builtin-name
            color: hljs-literal

        &-tag, &-xmlDocTag
            color: hljs-tag

        &-name, &-attr_selector, &-constant, &-value, &-tag &-title
            color: hljs-name

        &-title, &-class &-title, &-parent, &-id, &-class, &-pseudo, &-pragma,
        &-sub, &-decorator, &-selector-id, &-section
            color: hljs-title

        &-reserved
            color: hljs-reserved

        &-link_url
            text-decoration: underline

    .javascript .hljs-tag
        color: hljs-keyword

    .rust .hljs-preprocessor
        color: hljs-comment

    .coffeescript .hljs
        &-subst
            color: hljs-string

        &-attribute
            color: hljs-reserved

    .makefile .hljs
        &-variable
            color: hljs-string

        &-keyword
            color: hljs-literal

    .markdown .hljs-value
        color: hljs-string

    .nginx .hljs
        &-number
            color: hljs-string

        &-title
            color: hljs-keyword

        &-variable
            color: hljs-name

    .objectivec .hljs-preprocessor
        color: hljs-keyword

    .xml .hljs
        &-value
            color: hljs-string

        &-title
            color: hljs-tag

        &-tag
            color: hljs-name

        &-attribute
            color: hljs-title

    .less .hljs
        &-built_in
            color: hljs-string

        &-tag
            color: hljs-keyword

    .scss .hljs
        &-built_in
            color: hljs-string

        &-tag
            color: hljs-keyword

        &-preprocessor
            color: hljs-literal

        &-variable
            color: hljs-name

    .sql .hljs-built_in
        color: hljs-keyword

    .swift .hljs-preprocessor
        color: hljs-keyword

    .apache .hljs-keyword
        color: hljs-literal

    .ruby .hljs
        &-constant, &-subst &-keyword
            color: hljs-literal

    .go .hljs-constant
        color: hljs-literal

    .bash .hljs-variable
        color: hljs-name

    .cs .hljs-preprocessor
        &, .hljs-keyword
            color: hljs-name

    .ini .hljs-keyword
        color: hljs-name

// Diff code
.diff
    .hljs-addition, .hljs-deletion, .hljs-change
        display: block
        margin-bottom: -1.6em

    .hljs-chunk
        color: #ffc66d
        font-weight: bold

    .hljs-addition
        background-color: dark-green

    .hljs-deletion
        background-color: dark-grey

    .hljs-change
        background-color: dark-blue

// Editor
.tm-editor
    background: third-bg

    textarea
        background: sec-bg
        color: white
        border-color: third-bg

    .panel
        background: transparent
        border-color: transparent

        .wysiwyg_wrapper
            background: inherit

            .can_use_html, .btn
                border: 0

            .btn
                .g-icon
                    color: #777

                select
                    cursor: pointer

            .help_holder
                h4
                    color: #999

                dl
                    dt
                        color: #ccc

                    dd
                        color: #999

    & &__footer
        background-color: transparent
        border-color: transparent

        .markdown_checkbox
            color: inherit


// Buttons
$button
    background-color: sec-bg
    box-shadow: inset 0 1px 0 #2a2a2a
    text-shadow: 0 1px 0 #2a2a2a
    border-width: 0
    color: white

$button-disabled
    background-color: sec-bg
    text-shadow: none

    &:hover
        color: white
        background-color: #666

button(basic = true, input = false)
    button-hover()

    &, &:focus, &:active, &:visited
        @extend $button

    unless basic
        &.btn_active, &.loading
            @extend $button

        if input
            &[disabled]
                @extend $button
                @extend $button-disabled
        else
            &.disabled
                @extend $button
                @extend $button-disabled

    &:hover
        color: white

$button-basic
    button()

:not(.voting-wjt):not(.voting-wjt__counter):not(.favorite-wjt):not(.user-message):not(.wysiwyg-toolbar__item) > button
    @extend $button-basic

a.habracut
    @extend $button-basic

.buttons a.button
    &, &:active, &:focus
        @extend $button-basic

$button-green
    button-hover(dark-green)

$button-blue
    button-hover(dark-blue)

.buttons
    input[type=button], input[type=submit]
        button(false, true)

    input[type=submit].green
        @extend $button-green

button, a.button
    &.blue
        @extend $button-blue

    &.green
        @extend $button-green

button, a.btn
    &.btn_blue
        @extend $button-blue

    &.btn_green
        @extend $button-green

    &.btn_grey
        button-hover(dark-grey)


.blue_buttons_panel
    background: #6c747a


.dropdown
    &.dropdown_flows
        button
            margin: 1px 0 0 1px

.dropdown-container
    background-color: main-bg

    .dropdown__user-stast
        background-color: sec-bg
        color: inherit

    .n-dropdown-menu
        background-color: transparent

        &__item-link, .checkbox__label
            color: inherit

// Trackers page
.tracker_page table
    &.tracker_comments tr td.comment_count a
        color: #cf5555

    &[class^=tracker] tr
        &.new
            background: sec-bg

        th
            border-bottom-color: #777

        td
            border-bottom-color: third-bg

// Corporate blogs
#header_mouse_activity
    #header
        background: main-bg

    .main_menu a.active
        color: #949494

    .user_panel a
        color: #888

        &.username
            color: #8d8d8d

.company_top_banner img
    img_grayscale()

.company_info, .company_links, .corporate_news, .corporate_blog,
.mobile_applications, .hantim_vacanies, .twitter_stream
    padding: 5px

.comments_form h2.title
    background: none
    padding-left: 0

// Bottom promo TODO
.bottom_promo_blocks .block
    background: sec-bg

    &.new_vacanies .vacancies .job_item,
    &.freelansim .tasks .task
        a
            link()

.promo-block
    &__header, &__footer, &__service, &__content
        background: transparent

    &__header
        border-bottom: 1px solid dark-grey

    &__footer
        border-top: 1px solid dark-grey

.similar-posts
    background: sec-bg

    .content-list
        .post-preview__link
            link()
    .content-list_posts
        .content-list__item
            border-color: third-bg

.live-broadcast[class*=live-broadcast_], [class*=live-broadcast_], .promo-block
    background-color: transparent
    border-color: transparent

    .tabs__menu
        background: rgba(0, 0, 0, .1)

.content-list__item
    &::before
        img_grayscale(false)

    &:hover::before
        opacity: 1
        filter(grayscale(0))

    &-link
        color: #b5b5b5

        &:visited
            color: #666
    &_devided
        border-bottom: 1px solid dark-grey

.task__title, .vacancy__title
    color: heading

.task__aside, .vacancy__aside
    color: dark-grey

// Chosen
.chosen-container
    .chosen-results
        .highlighted
            color: black

            .subscribers
                color: black

    .chosen-drop
        background: sec-bg
        color: white
        border-color: third-bg

    &-multi
        .chosen-choices
            background: sec-bg
            color: white
            border-color: third-bg

            .search-choice
                color: black

            .search-field input
                @extends input[type=text]

    &-single, &-active.chosen-with-drop
        .chosen-single
            background-color: sec-bg

.webui-popover .popover
    border-color: #777

    .user-popover
        background-color: main-bg

.column-wrapper_bordered, .live-broadcast__content
    border-color: third-bg

// Users statistics
.user_statistics
    .graph
        text
            fill: white !important

        path[stroke="#000000"]
            stroke: white

    table.table
        tr
            th
                background: third-bg
                color: #999

            td
                color: #aaa

                &.comments, &.favorites, &.score, &.views
                    background-image: url('https://habrastorage.org/files/f7a/5ce/055/f7a5ce055a8d47a79f39412a6989d51a.gif')

                &.epic_fail
                    background-color: epic_fail

                &.fail
                    background-color: fail

                &.normal
                    background-color: normal

                &.successful
                    background-color: successful

                &.score
                    &[style^="color:green"]
                        color: font-green !important
                        text-shadow: 0 0 1px #040

            &:hover
                background: #3c3d34

                td
                    &.comments, &.favorites, &.score, &.views
                        background-image: url('https://habrastorage.org/files/6b2/6a2/bb3/6b26a2bb30d148b082aee4f8d0b21446.gif')

    .legend
        .text
            color: inherit

        .color
            &.yellow
                background-color: fail

            &.blue
                background-color: normal

            &.green
                background-color: successful


.user_settings .notification_table tr
    th, td
        color: inherit

.beta-anounce__text
    color: main-font-color


